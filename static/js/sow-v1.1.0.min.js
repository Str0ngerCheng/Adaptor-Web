!function(){!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Sow=e()}}(function(){return function(){function e(t,n,i){function r(a,o){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){return r(t[a][1][e]||e)},d,d.exports,e,t,n,i)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}return e}()({1:[function(e,t,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function s(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,n,i,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var d=new Error('Uncaught, unspecified "error" event. ('+t+")");throw d.context=t,d}if(n=this._events[e],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(a(n))for(s=Array.prototype.slice.call(arguments,1),u=n.slice(),i=u.length,l=0;l<i;l++)u[l].apply(this,s);return!0},i.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(n=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},i.prototype.removeListener=function(e,t){var n,i,s,o;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(o=s;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){i=o;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=e("../events"),u=i(l),d=e("../event-handler"),c=i(d),f=function(e){function t(e){r(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING,u.default.BUFFER_APPENDING,u.default.BUFFER_RESET));return n.wfs=e,n.mediaSource=null,n.media=null,n.pendingTracks={},n.sourceBuffer={},n.segments=[],n.appended=0,n._msDuration=null,n.appending=!1,n.onsbue=n.onSBUpdateEnd.bind(n),n.browserType=0,-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&(n.browserType=1),n.mediaType="H264Raw",n.ip=void 0,n.port=void 0,n.websocketName=void 0,n.channelName=void 0,n.websocket=void 0,n.startAppend=0,n}return a(t,e),o(t,[{key:"destroy",value:function(){c.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;this.ip=e.ip,this.port=e.port,this.mediaType=e.mediaType,this.websocketName=e.websocketName,this.channelName=e.channelName,this.websocket=e.websocket,t&&(this.mediaSource=new MediaSource,t.src=URL.createObjectURL(this.mediaSource),this.onmso=this.onMediaSourceOpen.bind(this),this.mediaSource.addEventListener("sourceopen",this.onmso))}},{key:"onMediaDetaching",value:function(){}},{key:"onBufferAppending",value:function(e){var t=this;this.segments?this.segments.push(e):this.segments=[e],void 0!=this.wfs.config.frameRate&&0==this.startAppend&&(this.startAppend=1,setInterval(function(){t.doAppending(),t.doAppending()},parseInt(1e3/this.wfs.config.frameRate)-3))}},{key:"onMediaSourceClose",value:function(){console.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){console.log("media source ended")}},{key:"onSBUpdateEnd",value:function(e){var t=this;if(1===this.browserType){this.mediaSource.endOfStream();var n=this.media.play();void 0!==n&&n.then(function(){t.media.play()}).catch(function(){})}this.appending=!1,this.doAppending(),this.updateMediaElementDuration()}},{key:"updateMediaElementDuration",value:function(){}},{key:"onMediaSourceOpen",value:function(){var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),"FMp4"===this.mediaType&&this.checkPendingTracks(),this.wfs.trigger(u.default.MEDIA_ATTACHED,{media:this.media,ip:this.ip,port:this.port,channelName:this.channelName,mediaType:this.mediaType,websocketName:this.websocketName,websocket:this.websocket})}},{key:"checkPendingTracks",value:function(){this.createSourceBuffers({tracks:"video",mimeType:""}),this.pendingTracks={}}},{key:"onBufferReset",value:function(e){"H264Raw"===this.mediaType&&this.createSourceBuffers({tracks:"video",mimeType:e.mimeType})}},{key:"createSourceBuffers",value:function(e){var t=this,n=(this.sourceBuffer,this.mediaSource,void 0);n=""===e.mimeType?"video/mp4;codecs=avc1.420028":"video/mp4;codecs="+e.mimeType;try{this.sourceBuffer.video=this.mediaSource.addSourceBuffer(n),this.sourceBuffer.video.addEventListener("updateend",this.onsbue),e.buffer=sb}catch(e){}this.wfs.trigger(u.default.BUFFER_CREATED,{tracks:e});var i=this.media.play();void 0!==i&&i.then(function(){t.media.play()}).catch(function(){})}},{key:"doAppending",value:function(){if(Object.keys(this.sourceBuffer).length){if(this.media.error)return console.log(this.media.error),this.segments=[],void console.log("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(this.segments&&this.segments.length)try{return this.sourceBuffer.video.appendBuffer(new Uint8Array(this.segments.shift().data)),this.appendError=0,void(this.appending=!0)}catch(e){return}}}}]),t}(c.default);n.default=f},{"../event-handler":7,"../events":8}],3:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=e("../events"),u=i(l),d=e("../event-handler"),c=i(d),f=function(e){function t(e){r(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHED,u.default.BUFFER_CREATED,u.default.FILE_PARSING_DATA,u.default.FILE_HEAD_LOADED,u.default.FILE_DATA_LOADED,u.default.WEBSOCKET_ATTACHED,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSING_INIT_SEGMENT));return n.fileStart=0,n.fileEnd=0,n.pendingAppending=0,n.mediaType=void 0,n.channelName,n}return a(t,e),o(t,[{key:"destroy",value:function(){c.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(e){if(""!=e.websocket&&void 0!=e.websocket&&"WebSocket"in window){var t=new WebSocket(e.websocket);this.wfs.attachWebsocket(t,e.channelName)}else if(void 0!=e.websocketName&&void 0!=e.ip&&void 0!=e.port&&"WebSocket"in window){var t=new WebSocket("ws://"+e.ip+":"+e.port+"/"+e.websocketName);this.wfs.attachWebsocket(t,e.channelName)}else console.log("Websocket Info Error!!!")}},{key:"onBufferCreated",value:function(e){this.mediaType=e.mediaType}},{key:"onFileHeadLoaded",value:function(e){}},{key:"onFileDataLoaded",value:function(e){}},{key:"onFileParsingData",value:function(e){}},{key:"onWebsocketAttached",value:function(e){this.wfs.trigger(u.default.BUFFER_APPENDING,{type:"video",data:e.payload,parent:"main"})}},{key:"onFragParsingInitSegment",value:function(e){var t,n,i=e.tracks;(n=i.video)&&(n.id=e.id);for(t in i){n=i[t];var r=n.initSegment;r&&(this.pendingAppending++,this.wfs.trigger(u.default.BUFFER_APPENDING,{type:t,data:r,parent:"main"}))}}},{key:"onFragParsingData",value:function(e){var t=this;[e.data1,e.data2].forEach(function(n){n&&(t.pendingAppending++,t.wfs.trigger(u.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main"}))})}}]),t}(c.default);n.default=f},{"../event-handler":7,"../events":8}],4:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=e("../utils/logger"),a=function(){function e(t){i(this,e),this.data=t,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return r(e,[{key:"loadWord",value:function(){var e=this.data.byteLength-this.bytesAvailable,t=new Uint8Array(4),n=Math.min(4,this.bytesAvailable);if(0===n)throw new Error("no bytes available");t.set(this.data.subarray(e,e+n)),this.word=new DataView(t.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&s.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0?n<<t|this.readBits(t):n}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,n,i=8,r=8;for(t=0;t<e;t++)0!==r&&(n=this.readEG(),r=(i+n+256)%256),i=0===r?i:r}},{key:"readSPS",value:function(){var e,t,n,i,r,s,a,o=0,l=0,u=0,d=0,c=1;if(this.readUByte(),e=this.readUByte(),this.readBits(5),this.skipBits(3),this.readUByte(),this.skipUEG(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var f=this.readUEG();if(3===f&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(s=3!==f?8:12,a=0;a<s;a++)this.readBoolean()&&(a<6?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var h=this.readUEG();if(0===h)this.readUEG();else if(1===h)for(this.skipBits(1),this.skipEG(),this.skipEG(),t=this.readUEG(),a=0;a<t;a++)this.skipEG();if(this.skipUEG(),this.skipBits(1),n=this.readUEG(),i=this.readUEG(),r=this.readBits(1),0===r&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(o=this.readUEG(),l=this.readUEG(),u=this.readUEG(),d=this.readUEG()),this.readBoolean()&&this.readBoolean()){var p=void 0;switch(this.readUByte()){case 1:p=[1,1];break;case 2:p=[12,11];break;case 3:p=[10,11];break;case 4:p=[16,11];break;case 5:p=[40,33];break;case 6:p=[24,11];break;case 7:p=[20,11];break;case 8:p=[32,11];break;case 9:p=[80,33];break;case 10:p=[18,11];break;case 11:p=[15,11];break;case 12:p=[64,33];break;case 13:p=[160,99];break;case 14:p=[4,3];break;case 15:p=[3,2];break;case 16:p=[2,1];break;case 255:p=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()]}p&&(c=p[0]/p[1])}return{width:Math.ceil((16*(n+1)-2*o-2*l)*c),height:(2-r)*(i+1)*16-(r?2:4)*(u+d)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();n.default=a},{"../utils/logger":16}],5:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=e("../events"),u=i(l),d=e("./exp-golomb"),c=i(d),f=e("../event-handler"),h=i(f),p=e("../remux/mp4-remuxer"),v=i(p),y=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,t);var i=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.H264_DATA_PARSED));return i.config=i.wfs.config||n,i.wfs=e,i.id="main",i.remuxer=new v.default(i.wfs,i.id,i.config),i.contiguous=!0,i.timeOffset=1,i.sn=0,i.TIMESCALE=9e4,i.timestamp=0,i.scaleFactor=i.TIMESCALE/1e3,i.H264_TIMEBASE=3e3,i._avcTrack={container:"video/mp2t",type:"video",id:1,sequenceNumber:0,samples:[],len:0,nbNalu:0,dropped:0,count:0},i.browserType=0,-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&(i.browserType=1),i.lastTime=0,i.lastTime1=0,i}return a(t,e),o(t,[{key:"destroy",value:function(){h.default.prototype.destroy.call(this)}},{key:"getTimestampM",value:function(){return this.timestamp+=this.H264_TIMEBASE,this.timestamp}},{key:"onH264DataParsed",value:function(e){this._parseAVCTrack(e.data),(1===this.browserType||this._avcTrack.samples.length>=1)&&(this.remuxer.pushVideo(0,this.sn,this._avcTrack,this.timeOffset,this.contiguous),this.sn+=1)}},{key:"_parseAVCTrack",value:function(e){var t=this,n=this._avcTrack,i=n.samples,r=this._parseAVCNALu(e),s=[],a=!1,o=0,l=void 0,d=void 0,f=void 0,h="",p=function(){if(s.length){if(!this.config.forceKeyFrameOnDiscontinuity||!0===a||n.sps&&(i.length||this.contiguous)){var e=this.getTimestampM(),t={units:{units:s,length:o},pts:e,dts:e,key:a};i.push(t),n.len+=o,n.nbNalu+=s.length}else n.dropped++;s=[],o=0}}.bind(this);r.forEach(function(e){switch(e.type){case 1:d=!0;break;case 5:d=!0,a=!0;break;case 6:d=!1;break;case 7:if(d=!1,!n.sps){l=new c.default(e.data);var i=l.readSPS();n.width=i.width,n.height=i.height,n.sps=[e.data],n.duration=0;var r=e.data.subarray(1,4),v="avc1.";for(f=0;f<3;f++){var y=r[f].toString(16);y.length<2&&(y="0"+y),v+=y}n.codec=v,t.wfs.trigger(u.default.BUFFER_RESET,{mimeType:n.codec}),d=!0}break;case 8:d=!1,n.pps||(n.pps=[e.data],d=!0);break;case 9:d=!1,p();break;default:d=!1,h+="unknown NAL "+e.type+" "}d&&(s.push(e),o+=e.data.byteLength)}),p(),r=null}},{key:"_parseAVCNALu",value:function(e){for(var t=0,n=e.byteLength,i=void 0,r=0,s=[],a=void 0,o=void 0,l=void 0,u=void 0;t<n;)switch(i=e[t++],r){case 0:0===i&&(r=1);break;case 1:r=0===i?2:0;break;case 2:case 3:0===i?r=3:1===i&&t<n?(o=31&e[t],l&&(a={data:e.subarray(l,t-r-1),type:u},s.push(a)),l=t,u=o,r=0):r=0}return l&&(a={data:e.subarray(l,n-1),type:u,state:r},s.push(a)),s}},{key:"discardEPB",value:function(e){for(var t,n,i=e.byteLength,r=[],s=1;s<i-2;)0===e[s]&&0===e[s+1]&&3===e[s+2]?(r.push(s+2),s+=2):s++;if(0===r.length)return e;t=i-r.length,n=new Uint8Array(t);var a=0;for(s=0;s<t;a++,s++)a===r[0]&&(a++,r.shift()),n[s]=e[a];return n}}]),t}(h.default);n.default=y},{"../event-handler":7,"../events":8,"../remux/mp4-remuxer":13,"./exp-golomb":4}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",OTHER_ERROR:"otherError"},n.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",INTERNAL_EXCEPTION:"internalException"}},{}],7:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("./events"),o=(function(e){e&&e.__esModule}(a),function(){function e(t){i(this,e),this.wfs=t,this.onEvent=this.onEvent.bind(this);for(var n=arguments.length,r=Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}return s(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===r(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.wfs.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.wfs.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var n=function(e,t){var n="on"+e.replace("wfs","");return this[n],this[n].bind(this,t)};try{n.call(this,e,t).call()}catch(t){console.log("internal error happened while processing "+e+":"+t.message)}}}]),e}());n.default=o},{"./events":8}],8:[function(e,t,n){"use strict";t.exports={MEDIA_ATTACHING:"wfsMediaAttaching",MEDIA_ATTACHED:"wfsMediaAttached",FRAG_LOADING:"wfsFragLoading",BUFFER_CREATED:"wfsBufferCreated",BUFFER_APPENDING:"wfsBufferAppending",BUFFER_RESET:"wfsBufferReset",FRAG_PARSING_DATA:"wfsFragParsingData",FRAG_PARSING_INIT_SEGMENT:"wfsFragParsingInitSegment",H264_DATA_PARSING:"wfsH264DataParsing",H264_DATA_PARSED:"wfsH264DataParsed",WEBSOCKET_ATTACHED:"wfsWebsocketAttached",WEBSOCKET_ATTACHING:"wfsWebsocketAttaching",WEBSOCKET_DATA_UPLOADING:"wfsWebsocketDataUploading",WEBSOCKET_MESSAGE_SENDING:"wfsWebsocketMessageSending",WEBSOCKET_CREATED:"wfsWebSocketCreated",FILE_HEAD_LOADING:"wfsFileHeadLoading",FILE_HEAD_LOADED:"wfsFileHeadLoaded",FILE_DATA_LOADING:"wfsFileDataLoading",FILE_DATA_LOADED:"wfsFileDataLoaded",FILE_PARSING_DATA:"wfsFileParsingData"}},{}],9:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(){i(this,e)}return r(e,null,[{key:"getSilentFrame",value:function(e){return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}]),e}();n.default=s},{}],10:[function(e,t,n){"use strict";t.exports=e("./sow.js").default},{"./sow.js":14}],11:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../events"),d=i(u),c=e("../event-handler"),f=i(c),h=e("../utils/h264-nal-slicesreader.js"),p=i(h),v=function(e){function t(e){r(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,d.default.WEBSOCKET_ATTACHING,d.default.WEBSOCKET_DATA_UPLOADING,d.default.WEBSOCKET_MESSAGE_SENDING));return n.buf=null,n.slicesReader=new p.default(e),n.mediaType=void 0,n.channelName=void 0,n}return a(t,e),l(t,[{key:"destroy",value:function(){!!this.client&&this.client.close(),this.slicesReader.destroy(),f.default.prototype.destroy.call(this)}},{key:"onWebsocketAttaching",value:function(e){this.mediaType=e.mediaType,this.channelName=e.channelName,e.websocket instanceof WebSocket&&(this.client=e.websocket,this.client.onopen=this.initSocketClient.bind(this),this.client.onclose=function(e){console.log("Websocket Disconnected!")},this.client.onerror=function(e){console.log("Websocket Error!")})}},{key:"initSocketClient",value:function(e){var t=this;this.client.binaryType="arraybuffer",this.client.onmessage=this.receiveSocketMessage.bind(this),console.log("Websocket Open!"),setInterval(function(){t.wfs.trigger(d.default.WEBSOCKET_MESSAGE_SENDING,{msgType:"alive"})},15e3)}},{key:"receiveSocketMessage",value:function(e){if("[object ArrayBuffer]"===Object.prototype.toString.call(e.data)){this.buf=new Uint8Array(e.data);var t=new Uint8Array(this.buf);"FMp4"===this.mediaType&&this.wfs.trigger(d.default.WEBSOCKET_ATTACHED,{payload:t}),"H264Raw"===this.mediaType&&this.wfs.trigger(d.default.H264_DATA_PARSING,{data:t})}else if(this.isJsonString(e.data)&&"[object Object]"===Object.prototype.toString.call(JSON.parse(e.data))){var n=JSON.parse(e.data);switch(n.msgType){case"streamInfo":this.wfs.config.frameRate=n.msgData.frameRate,this.wfs.config.enc=n.msgData.enc,this.wfs.config.width=n.msgData.width,this.wfs.config.height=n.msgData.height}}}},{key:"onWebsocketDataUploading",value:function(e){this.client.send(e.data)}},{key:"onWebsocketMessageSending",value:function(e){return!(!this.client||this.client.readyState!=WebSocket.OPEN)&&(this.client.send(JSON.stringify(e)),!0)}},{key:"isJsonString",value:function(e){try{if("object"==o(JSON.parse(e)))return!0}catch(e){}return!1}}]),t}(f.default);n.default=v},{"../event-handler":7,"../events":8,"../utils/h264-nal-slicesreader.js":15}],12:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(){i(this,e)}return r(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:i};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=s,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,a,l,a,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,r))}},{key:"box",value:function(e){for(var t,n=Array.prototype.slice.call(arguments,1),i=8,r=n.length,s=r;r--;)i+=n[r].byteLength;for(t=new Uint8Array(i),t[0]=i>>24&255,t[1]=i>>16&255,t[2]=i>>8&255,t[3]=255&i,t.set(e,4),r=0,i=8;r<s;r++)t.set(n[r],i),i+=n[r].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,n){return n*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,n,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,n))}},{key:"moov",value:function(t){for(var n=t.length,i=[];n--;)i[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var n=t.length,i=[];n--;)i[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(i))}},{key:"mvhd",value:function(t,n){n=0;var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,i)}},{key:"sdtp",value:function(t){var n,i,r=t.samples||[],s=new Uint8Array(4+r.length);for(i=0;i<r.length;i++)n=r[i].flags,s[i+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,s)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var n,i,r,s=[],a=[];for(n=0;n<t.sps.length;n++)i=t.sps[n],r=i.byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(i));for(n=0;n<t.pps.length;n++)i=t.pps[n],r=i.byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(i));var o=e.box(e.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|t.sps.length].concat(s).concat([t.pps.length]).concat(a))),l=t.width,u=t.height
;return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,106,101,102,102,45,121,97,110,47,47,47,103,119,102,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var n=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"stsd",value:function(t){return"audio"===t.type?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var n=t.id,i=t.duration*t.timescale,r=t.width,s=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,s>>8&255,255&s,0,0]))}},{key:"traf",value:function(t,n){var i=e.sdtp(t),r=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.trun(t,i.length+16+16+8+16+8+8),i)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,n){var i,r,s,a,o,l,u=t.samples||[],d=u.length,c=12+16*d,f=new Uint8Array(c);for(n+=8+c,f.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),i=0;i<d;i++)r=u[i],s=r.duration,a=r.size,o=r.flags,l=r.cts,f.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return e.box(e.types.trun,f)}},{key:"initSegment",value:function(t){e.types||e.init();var n,i=e.moov(t);return n=new Uint8Array(e.FTYP.byteLength+i.byteLength),n.set(e.FTYP),n.set(i,e.FTYP.byteLength),n}}]),e}();n.default=s},{}],13:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("../helper/aac"),o=i(a),l=e("../events"),u=i(l),d=e("../utils/logger"),c=e("../remux/mp4-generator"),f=i(c),h=e("../errors");e("../utils/polyfill");var p=function(){function e(t,n,i){r(this,e),this.observer=t,this.id=n,this.config=i,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR,this.nextAvcDts=90300,this.H264_TIMEBASE=3e3}return s(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"pushVideo",value:function(e,t,n,i,r){this.level=e,this.sn=t,this.ISGenerated||this.generateVideoIS(n,i),this.ISGenerated&&n.samples.length&&this.remuxVideo_2(n,i,r)}},{key:"remuxVideo_2",value:function(e,t,n,i){var r=8,s=(this.PES_TIMESCALE,this.PES2MP4SCALEFACTOR,void 0),a=void 0,o=e.samples,l=[];s=new Uint8Array(e.len+4*e.nbNalu+8);var c=new DataView(s.buffer);c.setUint32(0,s.byteLength),s.set(f.default.types.mdat,4);for(var h=0,p=void 0,v=void 0,y=void 0,m=0;m<o.length;m++){for(var g=o[m],b=0;g.units.units.length;){var E=g.units.units.shift();c.setUint32(r,E.data.byteLength),r+=4,s.set(E.data,r),r+=E.data.byteLength,b+=4+E.data.byteLength}var _=g.pts-this._initPTS,A=g.dts-this._initDTS;if(A=Math.min(_,A),void 0!==y)p=this._PTSNormalize(_,y),v=this._PTSNormalize(A,y),(h=v-y)<=0&&(d.logger.log("invalid sample duration at PTS/DTS: "+g.pts+"/"+g.dts+"|dts norm: "+v+"|lastDTS: "+y+":"+h),h=1);else{var T=this.nextAvcDts,w=void 0;p=this._PTSNormalize(_,T),v=this._PTSNormalize(A,T),T&&(w=Math.round(v-T),Math.abs(w)<600&&w&&(w>1?d.logger.log("AVC:"+w+" ms hole between fragments detected,filling it"):w<-1&&d.logger.log("AVC:"+-w+" ms overlapping between fragments detected"),v=T,p=Math.max(p-w,v),d.logger.log("Video/PTS/DTS adjusted: "+p+"/"+v+",delta:"+w))),this.firstPTS=Math.max(0,p),this.firstDTS=Math.max(0,v),h=.04}l.push({size:b,duration:this.H264_TIMEBASE,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:g.key?2:1,isNonSync:g.key?0:1}}),y=v}var S=0;l.length>=2&&(S=l[l.length-2].duration,l[0].duration=S),this.nextAvcDts=v+S;var k=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,l.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var D=l[0].flags;D.dependsOn=2,D.isNonSync=0}e.samples=l,a=f.default.moof(e.sequenceNumber++,v,e),e.samples=[];var R={id:this.id,level:this.level,sn:this.sn,data1:a,data2:s,startPTS:p,endPTS:p,startDTS:v,endDTS:v,type:"video",nb:l.length,dropped:k};this.observer.trigger(u.default.FRAG_PARSING_DATA,R)}},{key:"generateVideoIS",value:function(e,t){var n=this.observer,i=e.samples,r=(this.PES_TIMESCALE,{}),s={id:this.id,level:this.level,sn:this.sn,tracks:r,unique:!1},a=void 0===this._initPTS,o=void 0,l=void 0;a&&(o=l=1/0),e.sps&&e.pps&&i.length&&(e.timescale=9e4,r.video={container:"video/mp4",codec:e.codec,initSegment:f.default.initSegment([e]),metadata:{width:e.width,height:e.height}},a&&(o=Math.min(o,i[0].pts-this.H264_TIMEBASE),l=Math.min(l,i[0].dts-this.H264_TIMEBASE))),Object.keys(r).length?(n.trigger(u.default.FRAG_PARSING_INIT_SEGMENT,s),this.ISGenerated=!0,a&&(this._initPTS=o,this._initDTS=l)):e.sps&&e.pps&&console.log("generateVideoIS ERROR==> ",h.ErrorTypes.MEDIA_ERROR)}},{key:"remux",value:function(e,t,n,i,r,s,a,o){if(this.level=e,this.sn=t,this.ISGenerated||this.generateIS(n,i,a),this.ISGenerated)if(n.samples.length){var l=this.remuxAudio(n,a,o);if(i.samples.length){var d=void 0;l&&(d=l.endPTS-l.startPTS),this.remuxVideo(i,a,o,d)}}else{var c=void 0;i.samples.length&&(c=this.remuxVideo(i,a,o)),c&&n.codec&&this.remuxEmptyAudio(n,a,o,c)}r.samples.length&&this.remuxID3(r,a),s.samples.length&&this.remuxText(s,a),this.observer.trigger(u.default.FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function(e,t,n){var i,r,s=this.observer,a=e.samples,o=t.samples,l=this.PES_TIMESCALE,c={},p={id:this.id,level:this.level,sn:this.sn,tracks:c,unique:!1},v=void 0===this._initPTS;if(v&&(i=r=1/0),e.config&&a.length){if(e.timescale=e.audiosamplerate,e.timescale*e.duration>Math.pow(2,32)){e.timescale=e.audiosamplerate/function e(t,n){return n?e(n,t%n):t}(e.audiosamplerate,1024)}d.logger.log("audio mp4 timescale :"+e.timescale),c.audio={container:"audio/mp4",codec:e.codec,initSegment:f.default.initSegment([e]),metadata:{channelCount:e.channelCount}},v&&(i=r=a[0].pts-l*n)}t.sps&&t.pps&&o.length&&(t.timescale=this.MP4_TIMESCALE,c.video={container:"video/mp4",codec:t.codec,initSegment:f.default.initSegment([t]),metadata:{width:t.width,height:t.height}},v&&(i=Math.min(i,o[0].pts-l*n),r=Math.min(r,o[0].dts-l*n))),Object.keys(c).length?(s.trigger(u.default.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,v&&(this._initPTS=i,this._initDTS=r)):s.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,n,i){var r,s,a,o,l,c,h,p=8,v=this.PES_TIMESCALE,y=this.PES2MP4SCALEFACTOR,m=e.samples,g=[],b=void 0;b=n?this.nextAvcDts:t*v;var E=m[0];l=Math.max(this._PTSNormalize(E.dts,b)-this._initDTS,0),o=Math.max(this._PTSNormalize(E.pts,b)-this._initDTS,0);var _=Math.round((l-b)/90);n&&_&&(_>1?d.logger.log("AVC:"+_+" ms hole between fragments detected,filling it"):_<-1&&d.logger.log("AVC:"+-_+" ms overlapping between fragments detected"),l=b,m[0].dts=l+this._initDTS,o=Math.max(o-_,b),m[0].pts=o+this._initDTS,d.logger.log("Video/PTS/DTS adjusted: "+o+"/"+l+",delta:"+_)),E=m[m.length-1],h=Math.max(this._PTSNormalize(E.dts,b)-this._initDTS,0),c=Math.max(this._PTSNormalize(E.pts,b)-this._initDTS,0),c=Math.max(c,h);var A=navigator.vendor,T=navigator.userAgent,w=A&&A.indexOf("Apple")>-1&&T&&!T.match("CriOS");w&&(r=Math.round((h-l)/(y*(m.length-1))));for(var S=0;S<m.length;S++){var k=m[S];w?k.dts=l+S*y*r:(k.dts=Math.max(this._PTSNormalize(k.dts,b)-this._initDTS,l),k.dts=Math.round(k.dts/y)*y),k.pts=Math.max(this._PTSNormalize(k.pts,b)-this._initDTS,k.dts),k.pts=Math.round(k.pts/y)*y}s=new Uint8Array(e.len+4*e.nbNalu+8);var D=new DataView(s.buffer);D.setUint32(0,s.byteLength),s.set(f.default.types.mdat,4);for(var R=0;R<m.length;R++){for(var O=m[R],L=0,P=void 0;O.units.units.length;){var x=O.units.units.shift();D.setUint32(p,x.data.byteLength),p+=4,s.set(x.data,p),p+=x.data.byteLength,L+=4+x.data.byteLength}if(w)P=Math.max(0,r*Math.round((O.pts-O.dts)/(y*r)));else{if(R<m.length-1)r=m[R+1].dts-O.dts;else{var M=this.config,N=O.dts-m[R>0?R-1:R].dts;if(M.stretchShortVideoTrack){var I=M.maxBufferHole,C=M.maxSeekHole,U=Math.floor(Math.min(I,C)*v),B=(i?o+i*v:this.nextAacPts)-O.pts;B>U?(r=B-N,r<0&&(r=N),d.logger.log("It is approximately "+B/90+" ms to the next segment; using duration "+r/90+" ms for the last video frame.")):r=N}else r=N}r/=y,P=Math.round((O.pts-O.dts)/y)}g.push({size:L,duration:r,cts:P,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:O.key?2:1,isNonSync:O.key?0:1}})}this.nextAvcDts=h+r*y;var G=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,g.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var F=g[0].flags;F.dependsOn=2,F.isNonSync=0}e.samples=g,a=f.default.moof(e.sequenceNumber++,l/y,e),e.samples=[];var j={id:this.id,level:this.level,sn:this.sn,data1:a,data2:s,startPTS:o/v,endPTS:(c+y*r)/v,startDTS:o/v,endDTS:(c+y*r)/v,type:"video",nb:g.length,dropped:G};return this.observer.trigger(u.default.FRAG_PARSING_DATA,j),j}},{key:"remuxAudio",value:function(e,t,n){var i,r,s,a,l,c,h,p,v,y,m,g,b,E=this.PES_TIMESCALE,_=e.timescale,A=E/_,T=1024*e.timescale/e.audiosamplerate,w=8,S=[],k=[];e.samples.sort(function(e,t){return e.pts-t.pts}),k=e.samples;for(var D=n?this.nextAacPts:t*E,R=this._PTSNormalize(k[0].pts-this._initPTS,D),O=T*A,L=R+O,P=1;P<k.length;){var x=k[P],M=this._PTSNormalize(x.pts-this._initPTS,D),N=M-L;if(N<-.5*O)d.logger.log("Dropping frame due to "+Math.abs(N/90)+" ms overlap."),k.splice(P,1),e.len-=x.unit.length;else if(N>.5*O){var I=Math.round(N/O);d.logger.log("Injecting "+I+" frame"+(I>1?"s":"")+" of missing audio due to "+Math.round(N/90)+" ms gap.");for(var C=0;C<I;C++){var U=k[P-1].pts+O,B=o.default.getSilentFrame(e.channelCount);B||(d.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),B=x.unit.slice(0)),k.splice(P,0,{unit:B,pts:U,dts:U}),e.len+=B.length,P+=1}L+=(I+1)*O,x.pts=k[P-1].pts+O,P+=1}else Math.abs(N)>.1*O&&d.logger.log("Invalid frame delta "+(M-L+O)+" at PTS "+Math.round(M/90)+" (should be "+O+")."),L+=O,x.pts=k[P-1].pts+O,P+=1}for(;k.length;){if(r=k.shift(),a=r.unit,y=r.pts-this._initDTS,m=r.dts-this._initDTS,void 0!==v)g=this._PTSNormalize(y,v),b=this._PTSNormalize(m,v),s.duration=(b-v)/A;else{g=this._PTSNormalize(y,D),b=this._PTSNormalize(m,D);var G=Math.round(1e3*(g-D)/E);if(n&&G){if(G>0)d.logger.log(G+" ms hole between AAC samples detected,filling it");else if(G<-12){d.logger.log(-G+" ms overlapping between AAC samples detected, drop frame"),e.len-=a.byteLength;continue}g=b=D}if(h=Math.max(0,g),p=Math.max(0,b),!(e.len>0))return;l=new Uint8Array(e.len+8),i=new DataView(l.buffer),i.setUint32(0,l.byteLength),l.set(f.default.types.mdat,4)}l.set(a,w),w+=a.byteLength,s={size:a.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},S.push(s),v=b}var F=0,j=S.length;if(j>=2&&(F=S[j-2].duration,s.duration=F),j){this.nextAacPts=g+A*F,e.len=0,e.samples=S,c=f.default.moof(e.sequenceNumber++,p/A,e),e.samples=[];var H={id:this.id,level:this.level,sn:this.sn,data1:c,data2:l,startPTS:h/E,endPTS:this.nextAacPts/E,startDTS:p/E,endDTS:(b+A*F)/E,type:"audio",nb:j};return this.observer.trigger(u.default.FRAG_PARSING_DATA,H),H}return null}},{key:"remuxEmptyAudio",value:function(e,t,n,i){var r=this.PES_TIMESCALE,s=e.timescale?e.timescale:e.audiosamplerate,a=r/s,l=i.startDTS*r+this._initDTS,u=i.endDTS*r+this._initDTS,c=1024*a,f=Math.ceil((u-l)/c),h=o.default.getSilentFrame(e.channelCount);if(!h)return void d.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var p=[],v=0;v<f;v++){var y=l+v*c;p.push({unit:h.slice(0),pts:y,dts:y}),e.len+=h.length}e.samples=p,this.remuxAudio(e,t,n)}},{key:"remuxID3",value:function(e,t){var n,i=e.samples.length;if(i){for(var r=0;r<i;r++)n=e.samples[r],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE,n.dts=(n.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(u.default.FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var n,i=e.samples.length;if(i){for(var r=0;r<i;r++)n=e.samples[r],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(u.default.FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var n;if(void 0===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}},{key:"passthrough",get:function(){return!1}}]),e}();n.default=p},{"../errors":6,"../events":8,"../helper/aac":9,"../remux/mp4-generator":12,"../utils/logger":16,"../utils/polyfill":17}],14:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("./events"),o=i(a),l=e("./controller/flow-controller"),u=i(l),d=e("./controller/buffer-controller"),c=i(d),f=e("events"),h=i(f),p=e("./utils/xhr-loader"),v=i(p),y=e("./loader/websocket-loader"),m=i(y),g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=e.DefaultConfig;for(var i in n)i in t||(t[i]=n[i]);this.config=t;var s=this.observer=new h.default;s.trigger=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];s.emit.apply(s,[e,e].concat(n))},s.off=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];s.removeListener.apply(s,[e].concat(n))},this.on=s.on.bind(s),this.off=s.off.bind(s),this.trigger=s.trigger.bind(s),this.flowController=new u.default(this),this.bufferController=new c.default(this),this.websocketLoader=new m.default(this),this.mediaType=void 0,this.done=0}return s(e,null,[{key:"isSupported",value:function(){return window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42c01f,mp4a.40.2"')}},{key:"version",get:function(){return"v1.0.0v1.0.0"}},{key:"Events",get:function(){return o.default}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,startPosition:-1,debug:!1,fLoader:void 0,loader:v.default,fmp4FileUrl:"xxxx.mp4",fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,forceKeyFrameOnDiscontinuity:!0,appendErrorMaxRetry:3,frameRate:void 0,initBufferSize:1,enc:void 0,width:void 0,height:void 0}),e.defaultConfig},set:function(t){e.defaultConfig=t}}]),s(e,[{key:"destroy",value:function(){this.flowController.destroy(),this.bufferController.destroy(),this.websocketLoader.destroy()}},{key:"sendMsg",value:function(e){this.trigger(o.default.WEBSOCKET_MESSAGE_SENDING,e)}},{key:"attachMedia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"192.168.0.233",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"10010",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"H264Raw",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"ch1";this.mediaType=s,this.media=e,this.ip=t,this.port=n,this.websocketName=i;var l="ws://"+t+":"+n+"/"+i;this.websocket=l,this.trigger(o.default.MEDIA_ATTACHING,{media:e,ip:t,port:n,channelName:a,mediaType:s,websocketName:i,websocket:l}),document.addEventListener("visibilitychange",function(){1==document.hidden?r.websocketLoader.client.close():0==document.hidden&&r.trigger(o.default.MEDIA_ATTACHED,{media:e,ip:t,port:n,channelName:a,mediaType:s,websocketName:i,websocket:l})})}},{key:"attachData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"H264Raw",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"ch1";this.mediaType=i,this.media=e,this.websocket=t,this.trigger(o.default.MEDIA_ATTACHING,{media:e,ip:void 0,port:void 0,channelName:r,mediaType:i,websocketName:void 0,websocket:t}),document.addEventListener("visibilitychange",function(){1==document.hidden?n.websocketLoader.client.close():0==document.hidden&&n.trigger(o.default.MEDIA_ATTACHED,{media:e,ip:void 0,port:void 0,channelName:r,mediaType:i,websocketName:void 0,websocket:t})})}},{key:"closeWs",value:function(){this.websocketLoader.client.close()}},{key:"attachWebsocket",value:function(e,t){this.trigger(o.default.WEBSOCKET_ATTACHING,{websocket:e,mediaType:this.mediaType,channelName:t})}}]),e}();n.default=g},{"./controller/buffer-controller":2,"./controller/flow-controller":3,"./events":8,"./loader/websocket-loader":11,"./utils/xhr-loader":18,events:1}],15:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=e("../events"),u=i(l),d=e("../event-handler"),c=i(d),f=e("../demux/h264-demuxer"),h=i(f),p=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,t);var i=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.H264_DATA_PARSING));return i.config=i.wfs.config||n,i.h264Demuxer=new h.default(e),i.wfs=e,i.lastBuf=null,i.nals=[],i.lastTime=0,i.buffer=[],i.parseState=!1,i.i=0,i}return a(t,e),o(t,[{key:"destroy",value:function(){this.lastBuf=null,this.nals=[],c.default.prototype.destroy.call(this)}},{key:"_read",value:function(e){var t=null;if(this.nals=[],e&&!(e.byteLength<1)){this.lastBuf?(t=new Uint8Array(e.byteLength+this.lastBuf.length),t.set(this.lastBuf),t.set(new Uint8Array(e),this.lastBuf.length)):t=new Uint8Array(e);for(var n=0,i=-1,r=-2,s=new Array,a=0;a<t.length;a+=2){var o=t[a],l=t[a+1];0==i&&0==o&&0==l?s.push(a-1):1==l&&0==o&&0==i&&0==r&&s.push(a-2),r=o,i=l}if(s.length>1)for(var u=0;u<s.length-1;++u)this.nals.push(t.subarray(s[u],s[u+1]+1)),n=s[u+1];else n=s[0];if(0!=n&&n<t.length)this.lastBuf=t.subarray(n);else{this.lastBuf||(this.lastBuf=t);var d=new Uint8Array(this.lastBuf.length+e.byteLength);d.set(this.lastBuf),d.set(new Uint8Array(e),this.lastBuf.length),this.lastBuf=d}t=null}}},{key:"onH264DataParsing",value:function(e){this._read(e.data);var t=this;this.nals.forEach(function(e){t.wfs.trigger(u.default.H264_DATA_PARSED,{data:e})})}}]),t}(c.default);n.default=p},{"../demux/h264-demuxer":5,"../event-handler":7,"../events":8}],16:[function(e,t,n){"use strict";function i(){}function r(e,t){return t="["+e+"] > "+t}function s(e){var t=window.console[e];return t?function(){for(var n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];i[0]&&(i[0]=r(e,i[0])),t.apply(window.console,i)}:i}function a(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];n.forEach(function(t){u[t]=e[t]?e[t].bind(e):s(t)})}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l={trace:i,debug:i,log:i,warn:i,info:i,error:i},u=l;n.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":o(e))){a(e,"debug","log","info","warn","error");try{u.log()}catch(e){u=l}}else u=l},n.logger=u},{}],17:[function(e,t,n){"use strict";"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){var n=new Uint8Array(this);void 0===t&&(t=n.length);for(var i=new ArrayBuffer(t-e),r=new Uint8Array(i),s=0;s<r.length;s++)r[s]=n[s+e];return i})},{}],18:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(t){i(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return r(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"loadHead",value:function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay;var i=new XMLHttpRequest;i.open("head",e.url),i.onload=function(){n.onSuccess(i.getResponseHeader("content-length"))},i.send()}},{key:"load",value:function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e,t=this.context;e="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onloadend=this.loadend.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",t.url,!0),t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.responseType=t.responseType;var n=this.stats;n.tfirst=0,n.loaded=0,this.xhrSetup&&this.xhrSetup(e,t.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()}},{key:"loadend",value:function(e){var t=e.currentTarget,n=t.status,i=this.stats,r=this.context,s=this.config;if(!i.aborted)if(window.clearTimeout(this.requestTimeout),n>=200&&n<300){i.tload=Math.max(i.tfirst,performance.now());var a=void 0,o=void 0;"arraybuffer"===r.responseType?(a=t.response,o=a.byteLength):(a=t.responseText,o=a.length),i.loaded=i.total=o;var l={url:t.responseURL,data:a};this.callbacks.onSuccess(l,i,r)}else i.retry>=s.maxRetry||n>=400&&n<499?this.callbacks.onError({code:n,text:t.statusText},r):(this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),i.retry++)}},{key:"loadtimeout",value:function(){this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(e){var t=this.stats;0===t.tfirst&&(t.tfirst=Math.max(performance.now(),t.trequest)),t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total);var n=this.callbacks.onProgress;n&&n(t,this.context,null)}}]),e}();n.default=s},{}]},{},[10])(10)})}();